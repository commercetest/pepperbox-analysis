# CommerceTest PepperBox Analysis Tool

## What is this?
This tool processes files generated by [Commerce Test Pepper Box](https://github.com/commercetest/pepper-box) Consumers (.csv).
The output JSON file contains:
```
{
    threads: numberOfThreadsRun,
    avgMsgThroughputPerSecond: meanMessageThroughputPerSecond,
    avgByteThroughputPerSecond: meanByteThroughputPerSecond,
    avgLatencyXSecond: meanLatency,
    latencyXSecond: {"timestamp": avgSecondLatency},
    producedXSecond: [ [timestamp, numProducedMessages] ],
    consumedXSecond: [ [timestamp, numConsumedMessages] ]
}
```

## Why?
The purpose of this tool is to generate useful, Excel-able, graphable data from Million+ row CSV files

## How?
- Add your consumer output files to `in/[nubmer of threads]`
- Generate a `combined` file:
```bash
> # Pre-process CSV files
> cd in/10
> head -1 results-loadgen.0.csv > combined.csv && for filename in $(ls results*.csv); do awk -F "," '/[0-9]+/ {print }' $filename >> combined.csv; done
```
- Generate JSON output
```bash
> npm run process
```


## Extracting consumer-lag percentiles
```
> ./extractResults.sh in/3/*.csv
```
